{% extends 'base.html.twig' %}

{% block title %}
    {% if title is defined %}
        {{ title }}
    {% elseif singleCategory %}
        {{ category.name }} Quiz
    {% else %}
        All Categories Quiz
    {% endif %}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block body %}
    <div class="quiz-container">
        <a href="{{ path('quiz_index') }}" class="back-link">‚Üê Back to Categories</a>

        <div class="header">
            <h1>
                {% if title is defined %}
                    {{ title }}
                {% elseif singleCategory %}
                    {{ category.name }} Quiz
                {% else %}
                    Symfony 7.0 Quiz - All Categories
                {% endif %}
            </h1>
            <p>
                {% if isFailedQuestionsQuiz is defined and isFailedQuestionsQuiz %}
                    Practice the questions you've struggled with in the past
                {% else %}
                    Answer the following questions to test your knowledge
                {% endif %}
            </p>

            {% if isFailedQuestionsQuiz is defined and isFailedQuestionsQuiz and totalFailedQuestions is defined %}
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">Total Failed Questions</div>
                        <div class="stat-value">{{ totalFailedQuestions }}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Failures</div>
                        <div class="stat-value">{{ totalFailureCount }}</div>
                    </div>
                </div>

                {% if topFailedQuestions is defined and topFailedQuestions|length > 0 %}
                    <div class="most-failed-questions">
                        <h3>Questions You Struggle With The Most</h3>
                        <div class="failed-questions-list">
                            {% for item in topFailedQuestions %}
                                <div class="failed-question-item">
                                    <div class="question-text">{{ item.question.text }}</div>
                                    <div class="category-badge">{{ item.question.category.name }}</div>
                                    <div class="failure-count">Failed {{ item.failureCount }} times</div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}
            <p class="quiz-instructions"><strong>Note:</strong> Some questions may have multiple correct answers. Select all that apply.</p>
        </div>

        {% if questions|length > 0 %}
            <form action="{{ path('quiz_submit') }}" method="post" data-turbo="false">
                {% if singleCategory %}
                    <input type="hidden" name="category_id" value="{{ category.id }}">
                {% endif %}
                {% if isFailedQuestionsQuiz is defined and isFailedQuestionsQuiz %}
                    <input type="hidden" name="is_failed_questions_quiz" value="1">
                {% endif %}
                {% for question in questions %}
                    <div class="question-card">
                        {% if not singleCategory %}
                            <div class="category-label">{{ question.category.name }}</div>
                        {% endif %}
                        <div class="question-text">{{ question.text|nl2br }}</div>

                        {% for answer in question.answers %}
                            <div class="answer-option">
                                <input type="checkbox" id="answer-{{ question.id }}-{{ answer.id }}"
                                       name="answers[{{ question.id }}][]" value="{{ answer.id }}">
                                <label for="answer-{{ question.id }}-{{ answer.id }}">{{ answer.text }}</label>
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}

                <button type="submit" class="btn-submit">Submit Answers</button>
            </form>
        {% else %}
            <p>No questions available for this quiz.</p>
        {% endif %}
    </div>
{% endblock %}
